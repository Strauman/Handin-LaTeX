
%!TEX root = main.tex
%\BDOC
%:Â§ex
%:Here are commands related to creating exercises
%:-
\makeatletter
\newlength{\partproblemheadermargin}
\newlength{\problemheadermargin}
\newlength{\probleminset}
\setlength{\problemheadermargin}{0em}
\setlength{\probleminset}{3em}
\setlength{\partproblemheadermargin}{2em}


\def\fullproblemmargin{\dimexpr -\extramargins/2+\problemheadermargin\relax}
\def\fullpartproblemmargin{\dimexpr \partproblemheadermargin\relax}


\newcommand{\atMargin}[2]{\strut\vadjust{\domark{#1}{#2}}}

\newcommand{\domark}[2]{%
  \hbox to #2{
    \vbox to 0pt{
      \kern-\dp\strutbox
      \smash{\llap{#1}}
      \vss
    }%
  }
}
\gdef\isFirstProblem{1}
\def\AtFirstProblem{
\begin{addmargin}{\probleminset}
\preto\@enddocumenthook{\end{addmargin}}
}
%Macro containing exercise number
\def\exerciseNr{0}
%:=\problem{text}
%: This command will print out a problem header. For example \problem{1}
%: prints a nice big header \!textbf{Problem 1} You can do a star (*) after \problem to
%: prevent it from showing in the table of contents
%:-
%:=\problem*{text}
%: Does the same as \problem, but does not add the problem to the table of contents
%:-
\gdef\problem{\@ifstar{\@problem}{\@problemTOC}}
\gdef\@problemTOC#1{%
  \addcontentsline{toc}{section}{\@tr{Problem} #1}%
  \@problem{#1}%
}
\def\@problem#1{%
\def\isTrue{1}%
\if\isFirstProblem\isTrue%
\AtFirstProblem%
\gdef\isFirstProblem{0}%
\fi%
% Update exercise number
  \def\exerciseNr{#1}%
  \vbox to 0pt{%
    \hspace*{\fullproblemmargin}{\normalfont\Large\bfseries \@tr{Problem} #1}%
  }\vspace*{1.5\baselineskip}%
}
%:=\pproblem{text}
%: This command will print out a part problem header based on what problem you are on.
%: For example if you already have done \problem{1}, then \pproblem{a}
%: prints a nice big header \!textbf{(1a)}. You can do a star (*) after \pproblem to
%: prevent it from showing in the table of contents
%:-
%:=\pproblem*{text}
%: Does the same as \pproblem, but does not add the part problem to the table of contents
%:-
\gdef\pproblem{\@ifstar{\@pproblem}{\@pproblemTOC}}
\gdef\@pproblemTOC#1{%
  \addcontentsline{toc}{subsection}{\exerciseNr #1}%
  \@pproblem{#1}%
}
\def\@pproblem#1{%
% Write out problem number and letter
\atMargin{{\normalfont\Large\bfseries \exerciseNr #1)}}{\fullpartproblemmargin}\ignorespaces%
}
\makeatother
